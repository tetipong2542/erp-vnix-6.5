{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <div class="page-title-main">üöö ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏ô‡∏™‡πà‡∏á</div>
    <div class="text-muted">‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤ ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏û‡∏¥‡∏°‡∏û‡πå Master ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</div>
  </div>
</div>

<form method="post" action="{{ url_for('admin_logistics_merge') }}"
      onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô Master?');">

  <div class="row g-2 align-items-end mb-3">
    <div class="col-md-6">
      <label class="form-label fw-bold">Master (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</label>
      <input type="text" class="form-control" name="master" placeholder="‡πÄ‡∏ä‡πà‡∏ô SPX Express">
      <div class="form-text">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ dropdown ‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏ß</div>


      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" name="apply_existing" value="1" id="applyExisting" checked>
        <label class="form-check-label" for="applyExisting">
          ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Master ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
        </label>
      </div>
    </div>
    <div class="col-md-6 text-end">
      <button class="btn btn-primary" id="btnApply" disabled>‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô Master</button>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:40px;"></th>
          <th>‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Raw)</th>
          <th class="text-center" style="width:120px;"># ‡πÅ‡∏ñ‡∏ß</th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
        <tr>
          <td class="text-center">
            <input type="checkbox" class="rowchk" name="values" value="{{ it.raw }}">
          </td>
          <td class="fw-bold">{{ it.raw }}</td>
          <td class="text-center">{{ it.cnt }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</form>

<script>
(function(){
  const btn = document.getElementById('btnApply');
  const masterInput = document.querySelector('input[name="master"]');

  function refresh(){
    const checked = document.querySelectorAll('.rowchk:checked').length;
    const hasMaster = !!(masterInput && (masterInput.value || '').trim());
    btn.disabled = (checked < 1) || !hasMaster;
  }

  // dblclick row to copy raw into master (then user can shorten e.g. SPX)
  document.querySelectorAll('tbody tr').forEach(tr => {
    tr.addEventListener('dblclick', () => {
      const raw = (tr.querySelector('td.fw-bold')?.innerText || '').trim();
      if (raw && masterInput) {
        masterInput.value = raw;
        refresh();
      }
    });
  });

  if (masterInput) {
    masterInput.addEventListener('input', refresh);
  }
  document.querySelectorAll('.rowchk').forEach(x => x.addEventListener('change', refresh));
  refresh();
})();
</script>

{% endblock %}
